<template>
    <div class="slds-box slds-theme_default">
        <lightning-card title="Weekly Timesheet View">
            <div class="slds-p-around_medium">

                <div class="slds-grid slds-gutters">
                    <div class="slds-col slds-p-top_x-small">
                        <lightning-combobox name="Previous Timesheets" options={prevTimesheets} onchange={prevTimesheet}>
                        </lightning-combobox>
                    </div>
                    <div class="slds-col slds-p-top_x-small">
                        <lightning-button label="Copy" onclick={handleCopy}></lightning-button>
                    </div>
                </div>

                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th class="slds-text-title_caps">Activity Name</th>
                            <th class="slds-text-title_caps">Monday</th>
                            <th class="slds-text-title_caps">Tuesday</th>
                            <th class="slds-text-title_caps">Wednesday</th>
                            <th class="slds-text-title_caps">Thursday</th>
                            <th class="slds-text-title_caps">Friday</th>
                            <th class="slds-text-title_caps">Saturday</th>
                            <th class="slds-text-title_caps">Sunday</th>
                            <th class="slds-text-title_caps">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Section Header for Totals -->
                        <tr class="slds-theme_shade">
                            <td class="slds-text-title_bold">Total</td>
                            <template for:each={grandTotals} for:item="total" for:index="index">
                                <td key={grandTotals.index} class="slds-text-title_bold">
                                    {total}
                                </td>
                            </template>
                            <td></td>
                        </tr>

                        <!-- Section Header for Projects -->
                        <tr>
                            <td class="slds-text-title_bold slds-theme_shade slds-p-around_x-small">Projects</td>
                            <template for:each={projectsTotals} for:item="total" for:index="index">
                                <td key={projectsTotals.index} class="slds-text-title_bold slds-theme_shade slds-p-around_x-small">
                                    {total}
                                </td>
                            </template>
                            <td class="slds-theme_shade"></td>
                        </tr>

                        <template for:each={projectsList} for:item="row" for:index="index">
                            <tr key={row.projectName} class="slds-hint-parent">
                                <td>
                                    <lightning-combobox name="projectName" value={row.projectName}
                                        options={projectOptions} data-row-index={index}
                                        onchange={handleProjectChange}>
                                    </lightning-combobox>

                                    <lightning-combobox name="activityName" value={row.activityName}
                                        options={activityOptions} data-row-index={index}
                                        onchange={handleProjectChange}>
                                    </lightning-combobox>
                                </td>

                                <template for:each={row.dates} for:item="day" for:index="dayIndex">
                                    <td key={day.name}>
                                        <div class="slds-grid slds-grid_vertical">
                                            <div class="slds-col">
                                                <lightning-input type="number" title="Duration" value={day.dur}
                                                    step="0.5" min="0" max="24" data-for="project"
                                                    data-row-index={index} data-day-index={dayIndex} onchange={handleDurationChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col">
                                                <lightning-textarea title="Description" value={day.desc} disabled={day.isdisable}
                                                    data-row-index={index} data-day-index={dayIndex}>
                                                </lightning-textarea>
                                            </div>
                                        </div>
                                    </td>
                                </template>

                                <td>
                                    <lightning-button-icon icon-name="utility:delete" alternative-text="Delete" class="slds-m-left_xx-small"
                                        variant="border-filled" data-row-index={index} data-type="project" onclick={handleDeleteRow}>
                                    </lightning-button-icon>
                                </td>
                            </tr>
                        </template>

                        <!-- Section Header for Absence -->
                        <tr>
                            <td class="slds-text-title_bold slds-theme_shade slds-p-around_x-small">Absence</td>
                            <template for:each={absenceTotals} for:item="total" for:index="index">
                                <td key={absenceTotals.index} class="slds-text-title_bold slds-theme_shade slds-p-around_x-small">
                                    {total}
                                </td>
                            </template>
                            <td class="slds-theme_shade"></td>
                        </tr>

                        <template for:each={absenceList} for:item="row" for:index="index">
                            <tr key={row.absenceName} class="slds-hint-parent">
                                <td>
                                    <lightning-combobox name="absenceName" value={row.absenceName} 
                                        options={absenceOptions}
                                        data-row-index={index} onchange={handleAbsenceChange}>
                                    </lightning-combobox>
                                </td>
                        
                                <template for:each={row.dates} for:item="day" for:index="dayIndex">
                                    <td key={day.name}>
                                        <div class="slds-grid slds-grid_vertical">
                                            <div class="slds-col">
                                                <lightning-input type="number" title="Duration" value={day.dur} step="0.5" min="0" max="24" data-for="absence"
                                                    data-row-index={index} data-day-index={dayIndex} onchange={handleDurationChange}>
                                                </lightning-input>
                                            </div>
                                            <div class="slds-col">
                                                <lightning-textarea title="Description" value={day.desc} data-row-index={index}
                                                    data-day-index={dayIndex}>
                                                </lightning-textarea>
                                            </div>
                                        </div>
                                    </td>
                                </template>

                                <td>
                                    <lightning-button-icon icon-name="utility:delete" alternative-text="Delete" class="slds-m-left_xx-small"
                                        variant="border-filled" data-row-index={index} data-type="absence" onclick={handleDeleteRow}>
                                    </lightning-button-icon>
                                </td>
                            </tr>
                        </template>

                    </tbody>
                </table>

                <div class="slds-p-top_medium">
                    <lightning-button 
                        label="Add Project" onclick={addNewProject} variant="neutral" class="slds-m-right_x-small">
                    </lightning-button>
                    <lightning-button 
                        label="Add Absence" onclick={addNewAbsence} variant="neutral" class="slds-m-right_x-small">
                    </lightning-button>
                    <lightning-button 
                        label="Save" onclick={handleSave} variant="brand" class="slds-m-right_x-small">
                    </lightning-button>
                    <lightning-button 
                        label="Cancel" onclick={handleCancel} variant="neutral">
                    </lightning-button>
                    <lightning-button 
                        label="Calculate" onclick={calculateTotals} variant="brand">
                    </lightning-button>
                </div>
            </div>
        </lightning-card>
    </div>
</template>